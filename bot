!pip install python-telegram-bot
!pip install python-telegram-bot nest-asyncio
!pip install "python-telegram-bot[job-queue]" deep-translator nest-asyncio

import logging
import asyncio
import random
import string
import math
from datetime import datetime, timedelta
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, CallbackQueryHandler, filters, ContextTypes
import re
import sys

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

try:
    import nest_asyncio
    nest_asyncio.apply()
    logger.info("nest_asyncio –ø—Ä–∏–º–µ–Ω–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ Jupyter/Colab")
except ImportError:
    logger.debug("nest_asyncio –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ Python)")

translator_available = False
try:
    from deep_translator import GoogleTranslator
    translator_available = True
    logger.info("–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω")
except ImportError as e:
    translator_available = False
    logger.warning(f"–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ deep-translator: pip install deep-translator")

BOT_TOKEN = "8215455301:AAFlzrFATZQdKKyTIWcV6eOH4a5F8KjhpP4"

reminders = {}

JOKES = [
    "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ –ª—é–±—è—Ç –ø—Ä–∏—Ä–æ–¥—É? –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–∞–≥–æ–≤!",
    "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—å–µ—Ç –∫–æ—Ñ–µ? –°–æ–Ω–Ω—ã–π.",
    "–ü–æ—á–µ–º—É Python –ª—É—á—à–µ Java? –ü–æ—Ç–æ–º—É —á—Ç–æ Python –Ω–µ –Ω—É–∂–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∫–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!",
    "–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ–¥–∏–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –¥—Ä—É–≥–æ–º—É? '–£ –º–µ–Ω—è –¥–æ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!'",
    "–°–∫–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤–∫—Ä—É—Ç–∏—Ç—å –ª–∞–º–ø–æ—á–∫—É? –ù–∏ –æ–¥–Ω–æ–≥–æ, —ç—Ç–æ hardware –ø—Ä–æ–±–ª–µ–º–∞!",
    "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç —Ç–µ–º–Ω—É—é —Ç–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–≤–µ—Ç –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –±–∞–≥–∏!",
    "–ß—Ç–æ –æ–±—â–µ–≥–æ –º–µ–∂–¥—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º –∏ –≤–æ–ª—à–µ–±–Ω–∏–∫–æ–º? –û–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –º–∞–≥–∏–µ–π, –∫–æ—Ç–æ—Ä—É—é –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç.",
    "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –≤—Å–µ–≥–¥–∞ —Å–º–µ—é—Ç—Å—è –≤ 256-–π –¥–µ–Ω—å –≥–æ–¥–∞? –ü–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ FF (hex)!",
]

def create_main_menu():
    """–°–æ–∑–¥–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = [
        [
            InlineKeyboardButton("üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è", callback_data="menu_reminders"),
            InlineKeyboardButton("üåê –ü–µ—Ä–µ–≤–æ–¥", callback_data="menu_translate")
        ],
        [
            InlineKeyboardButton("üîê –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π", callback_data="menu_password"),
            InlineKeyboardButton("üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", callback_data="menu_calculator")
        ],
        [
            InlineKeyboardButton("üòÑ –°–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞", callback_data="menu_joke"),
            InlineKeyboardButton("üìè –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü", callback_data="menu_converter")
        ],
        [
            InlineKeyboardButton("üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ", callback_data="menu_random"),
            InlineKeyboardButton("üïê –í—Ä–µ–º—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö", callback_data="menu_timezone")
        ],
        [
            InlineKeyboardButton("üìã –ü–æ–º–æ—â—å", callback_data="menu_help")
        ]
    ]
    return InlineKeyboardMarkup(keyboard)

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    welcome_text = (
        f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! üëã\n\n"
        f"–Ø –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–æ—Ç —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.\n"
        f"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ:"
    )
    await update.message.reply_text(
        welcome_text,
        reply_markup=create_main_menu()
    )

async def menu_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é"""
    query = update.callback_query
    try:
        await query.answer()
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ callback: {e}")
    
    try:
        if query.data == "menu_reminders":
            text = (
                "üîî **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**\n\n"
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è:\n"
                "`/remind 10:30 –ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ`\n"
                "`/remind —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ü–æ–∑–≤–æ–Ω–∏—Ç—å –º–∞–º–µ`\n\n"
                "–î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                "`/list` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
                "`/cancel <–Ω–æ–º–µ—Ä>` - –æ—Ç–º–µ–Ω–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
    
        elif query.data == "menu_translate":
            text = (
                "üåê **–ü–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞**\n\n"
                "–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ –¥—Ä—É–≥–æ–π —è–∑—ã–∫:\n"
                "`/translate en –ü—Ä–∏–≤–µ—Ç`\n\n"
                "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:\n"
                "en (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π), es (–∏—Å–ø–∞–Ω—Å–∫–∏–π), fr (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π),\n"
                "de (–Ω–µ–º–µ—Ü–∫–∏–π), it (–∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π), ja (—è–ø–æ–Ω—Å–∫–∏–π),\n"
                "ko (–∫–æ—Ä–µ–π—Å–∫–∏–π), zh (–∫–∏—Ç–∞–π—Å–∫–∏–π) –∏ –¥—Ä—É–≥–∏–µ"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_password":
            text = (
                "üîê **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π**\n\n"
                "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å:\n"
                "`/password` - –ø–∞—Ä–æ–ª—å –∏–∑ 12 —Å–∏–º–≤–æ–ª–æ–≤\n"
                "`/password 16` - –ø–∞—Ä–æ–ª—å –∏–∑ 16 —Å–∏–º–≤–æ–ª–æ–≤\n"
                "`/password 20 strong` - —É—Å–∏–ª–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_calculator":
            try:
                example_expr = "2 + 2 * 3"
                result = eval(example_expr, {"__builtins__": {}, "math": math})
                
                text = (
                    f"üßÆ **–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä**\n\n"
                    f"**–ü—Ä–∏–º–µ—Ä –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:**\n"
                    f"`{example_expr} = {result}`\n\n"
                    f"**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**\n"
                    f"`/calc 2 + 2`\n"
                    f"`/calc 10 * 5`\n"
                    f"`/calc sqrt(16)`\n"
                    f"`/calc sin(30)`\n"
                    f"`/calc 2 * pi`\n\n"
                    f"**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:**\n"
                    f"+, -, *, /, **, sqrt(), sin(), cos(), tan(), pi, e"
                )
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: {e}")
                text = (
                    "üßÆ **–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä**\n\n"
                    "–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:\n"
                    "`/calc 2 + 2`\n"
                    "`/calc 10 * 5`\n"
                    "`/calc sqrt(16)`\n"
                    "`/calc sin(30)`\n\n"
                    "**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:**\n"
                    "+, -, *, /, **, sqrt(), sin(), cos(), tan(), pi, e"
                )
            try:
                await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: {e}")
                await query.message.reply_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_joke":
            joke = random.choice(JOKES)
            await query.edit_message_text(f"üòÑ **–°–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞**\n\n{joke}", parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_converter":
            text = (
                "üìè **–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü**\n\n"
                "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è:\n"
                "`/convert 100 km to miles`\n"
                "`/convert 25 celsius to fahrenheit`\n"
                "`/convert 1 kg to pounds`\n\n"
                "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: –¥–ª–∏–Ω–∞, –≤–µ—Å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_random":
            text = (
                "üé≤ **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª**\n\n"
                "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ:\n"
                "`/random` - —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100\n"
                "`/random 1 50` - —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 50\n"
                "`/random 100 1000` - —á–∏—Å–ª–æ –æ—Ç 100 –¥–æ 1000"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_timezone":
            text = (
                "üïê **–í—Ä–µ–º—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö**\n\n"
                "–£–∑–Ω–∞–π—Ç–µ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö:\n"
                "`/timezone Moscow`\n"
                "`/timezone New York`\n"
                "`/timezone Tokyo`\n"
                "`/timezone London`"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        elif query.data == "menu_help":
            text = (
                "üìã **–ü–æ–º–æ—â—å**\n\n"
                "**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\n"
                "`/start` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
                "`/menu` - –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é\n"
                "`/help` - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n"
                "**–§—É–Ω–∫—Ü–∏–∏:**\n"
                "üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
                "üåê –ü–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞\n"
                "üîê –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π\n"
                "üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä\n"
                "üòÑ –°–ª—É—á–∞–π–Ω—ã–µ —à—É—Ç–∫–∏\n"
                "üìè –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü\n"
                "üé≤ –°–ª—É—á–∞–π–Ω—ã–µ —á–∏—Å–ª–∞\n"
                "üïê –í—Ä–µ–º—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö"
            )
            await query.edit_message_text(text, parse_mode='Markdown', reply_markup=create_main_menu())
        
        else:
            logger.warning(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π callback_data: {query.data}")
            try:
                await query.answer("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞", show_alert=True)
            except:
                pass
    
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ menu_handler: {e}", exc_info=True)
        try:
            await query.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", show_alert=True)
        except:
            pass

async def set_reminder(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /remind"""
    if not context.args or len(context.args) < 2:
        await update.message.reply_text(
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /remind <–≤—Ä–µ–º—è> <—Å–æ–æ–±—â–µ–Ω–∏–µ>\n"
            "–ü—Ä–∏–º–µ—Ä: /remind 10:30 –ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"
        )
        return
    
    try:
        args_text = ' '.join(context.args)
        
        relative_match = re.match(r'—á–µ—Ä–µ–∑\s+(\d+)\s+(–º–∏–Ω—É—Ç|–º–∏–Ω—É—Ç—É|–º–∏–Ω—É—Ç—ã|—á–∞—Å|—á–∞—Å–∞|—á–∞—Å–æ–≤)\s+(.+)', args_text, re.IGNORECASE)
        if relative_match:
            amount = int(relative_match.group(1))
            unit = relative_match.group(2).lower()
            message = relative_match.group(3)
            
            now = datetime.now()
            if '–º–∏–Ω—É—Ç' in unit:
                reminder_time = now + timedelta(minutes=amount)
            elif '—á–∞—Å' in unit:
                reminder_time = now + timedelta(hours=amount)
            else:
                raise ValueError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏")
            
            reminder_id = len(reminders) + 1
            reminders[reminder_id] = {
                'user_id': update.effective_user.id,
                'chat_id': update.effective_chat.id,
                'message': message,
                'time': reminder_time,
                'original_time': f"—á–µ—Ä–µ–∑ {amount} {unit}"
            }
            
            await update.message.reply_text(
                f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ {reminder_time.strftime('%d.%m.%Y %H:%M')}\n"
                f"–°–æ–æ–±—â–µ–Ω–∏–µ: {message}"
            )
            return
        
        time_str = context.args[0]
        message = ' '.join(context.args[1:])
        time_match = re.match(r'(\d{1,2}):(\d{2})', time_str)
        if not time_match:
            raise ValueError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏")
        
        hour = int(time_match.group(1))
        minute = int(time_match.group(2))
        
        if hour < 0 or hour > 23 or minute < 0 or minute > 59:
            raise ValueError("–ù–µ–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è")
        
        now = datetime.now()
        reminder_time = now.replace(hour=hour, minute=minute, second=0, microsecond=0)
        
        if reminder_time <= now:
            reminder_time += timedelta(days=1)
        
        reminder_id = len(reminders) + 1
        reminders[reminder_id] = {
            'user_id': update.effective_user.id,
            'chat_id': update.effective_chat.id,
            'message': message,
            'time': reminder_time,
            'original_time': time_str
        }
        
        await update.message.reply_text(
            f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ {reminder_time.strftime('%d.%m.%Y %H:%M')}\n"
            f"–°–æ–æ–±—â–µ–Ω–∏–µ: {message}"
        )
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: {e}")
        await update.message.reply_text(
            f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: /remind 10:30 –°–æ–æ–±—â–µ–Ω–∏–µ"
        )

async def list_reminders(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = update.effective_user.id
    user_reminders = {k: v for k, v in reminders.items() if v['user_id'] == user_id}
    
    if not user_reminders:
        await update.message.reply_text("–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
        return
    
    text = "–í–∞—à–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:\n\n"
    for reminder_id, reminder in user_reminders.items():
        text += f"{reminder_id}. {reminder['time'].strftime('%d.%m.%Y %H:%M')} - {reminder['message']}\n"
    
    await update.message.reply_text(text)

async def cancel_reminder(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Ç–º–µ–Ω–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ"""
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /cancel <–Ω–æ–º–µ—Ä>")
        return
    
    try:
        reminder_id = int(context.args[0])
        user_id = update.effective_user.id
        
        if reminder_id in reminders and reminders[reminder_id]['user_id'] == user_id:
            del reminders[reminder_id]
            await update.message.reply_text(f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ {reminder_id} –æ—Ç–º–µ–Ω–µ–Ω–æ")
        else:
            await update.message.reply_text("–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
    except ValueError:
        await update.message.reply_text("–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è")

async def translate_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /translate"""
    if not context.args or len(context.args) < 2:
        await update.message.reply_text(
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /translate <—è–∑—ã–∫> <—Ç–µ–∫—Å—Ç>\n"
            "–ü—Ä–∏–º–µ—Ä: /translate en –ü—Ä–∏–≤–µ—Ç\n"
            "–Ø–∑—ã–∫–∏: en (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π), es (–∏—Å–ø–∞–Ω—Å–∫–∏–π), fr (—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π), de (–Ω–µ–º–µ—Ü–∫–∏–π), –∏ —Ç.–¥."
        )
        return
    
    if not translator_available:
        await update.message.reply_text(
            "–°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ deep-translator."
        )
        return
    
    try:
        target_lang = context.args[0].lower()
        text = ' '.join(context.args[1:])
        
        max_retries = 3
        for attempt in range(max_retries):
            try:
                translator = GoogleTranslator(source='auto', target=target_lang)
                translated_text = translator.translate(text)
                
                await update.message.reply_text(
                    f"–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: {text}\n\n"
                    f"–ü–µ—Ä–µ–≤–æ–¥ ({target_lang}): {translated_text}"
                )
                return
            except Exception as e:
                logger.warning(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å: {e}")
                if attempt < max_retries - 1:
                    await asyncio.sleep(2)
                else:
                    raise
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ: {e}")
        await update.message.reply_text(
            f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞ —è–∑—ã–∫–∞ –∏ —Ç–µ–∫—Å—Ç–∞.\n"
            f"–ü—Ä–∏–º–µ—Ä: /translate en –ü—Ä–∏–≤–µ—Ç\n"
            f"–û—à–∏–±–∫–∞: {str(e)}"
        )

async def check_reminders(context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
    if not reminders:
        return
    
    now = datetime.now()
    to_remove = []
    
    reminders_copy = dict(reminders)
    
    for reminder_id, reminder in reminders_copy.items():
        if reminder['time'] <= now:
            try:
                await context.bot.send_message(
                    chat_id=reminder['chat_id'],
                    text=f"üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {reminder['message']}"
                )
                to_remove.append(reminder_id)
                logger.info(f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ {reminder_id} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {reminder['user_id']}")
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è {reminder_id}: {e}")
                # –£–¥–∞–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ, —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å
                to_remove.append(reminder_id)
    
    # –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    for reminder_id in to_remove:
        if reminder_id in reminders:
            del reminders[reminder_id]

async def reminder_job(context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
    await check_reminders(context)

# –§—É–Ω–∫—Ü–∏—è 1: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π
async def generate_password(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π"""
    length = 12
    strong = False
    
    if context.args:
        try:
            if len(context.args) > 0:
                length = int(context.args[0])
                if length < 4:
                    length = 4
                elif length > 50:
                    length = 50
            if len(context.args) > 1 and context.args[1].lower() == 'strong':
                strong = True
        except ValueError:
            await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /password [–¥–ª–∏–Ω–∞] [strong]\n–ü—Ä–∏–º–µ—Ä: /password 16 strong")
            return
    
    if strong:
        # –£—Å–∏–ª–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å: –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
        characters = string.ascii_letters + string.digits + "!@#$%^&*()_+-=[]{}|;:,.<>?"
    else:
        # –û–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å: –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
        characters = string.ascii_letters + string.digits
    
    password = ''.join(random.choice(characters) for _ in range(length))
    await update.message.reply_text(
        f"üîê –í–∞—à –ø–∞—Ä–æ–ª—å ({length} —Å–∏–º–≤–æ–ª–æ–≤):\n\n`{password}`\n\n"
        f"‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!",
        parse_mode='Markdown'
    )

# –§—É–Ω–∫—Ü–∏—è 2: –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
async def calculator(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ—Å—Ç–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"""
    if not context.args:
        await update.message.reply_text(
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /calc <–≤—ã—Ä–∞–∂–µ–Ω–∏–µ>\n"
            "–ü—Ä–∏–º–µ—Ä—ã:\n"
            "`/calc 2 + 2`\n"
            "`/calc 10 * 5`\n"
            "`/calc sqrt(16)`\n"
            "`/calc sin(30)`",
            parse_mode='Markdown'
        )
        return
    
    try:
        expression = ' '.join(context.args)
        original_expr = expression
        
        # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π
        import re as regex_module
        expression = regex_module.sub(r'\bsqrt\b', 'math.sqrt', expression)
        expression = regex_module.sub(r'\bsin\b', 'math.sin', expression)
        expression = regex_module.sub(r'\bcos\b', 'math.cos', expression)
        expression = regex_module.sub(r'\btan\b', 'math.tan', expression)
        expression = regex_module.sub(r'\bpi\b', 'math.pi', expression)
        expression = regex_module.sub(r'\be\b', 'math.e', expression)
        
        result = eval(expression, {"__builtins__": {}, "math": math})
        
        if isinstance(result, float):
            if result.is_integer():
                result = int(result)
            else:
                result = round(result, 10)
        
        await update.message.reply_text(
            f"üßÆ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**\n\n`{original_expr}` = **{result}**",
            parse_mode='Markdown'
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ: {e}")
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è: {str(e)}\n\n"
            f"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è.\n"
            f"–ü—Ä–∏–º–µ—Ä: `/calc 2 + 2`",
            parse_mode='Markdown'
        )

# –§—É–Ω–∫—Ü–∏—è 3: –°–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞
async def random_joke(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —à—É—Ç–∫—É"""
    joke = random.choice(JOKES)
    await update.message.reply_text(f"üòÑ {joke}")

# –§—É–Ω–∫—Ü–∏—è 4: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü
async def unit_converter(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è"""
    if not context.args or len(context.args) < 4:
        await update.message.reply_text(
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /convert <–∑–Ω–∞—á–µ–Ω–∏–µ> <–∏–∑> <to> <–≤>\n"
            "–ü—Ä–∏–º–µ—Ä—ã:\n"
            "`/convert 100 km to miles`\n"
            "`/convert 25 celsius to fahrenheit`\n"
            "`/convert 1 kg to pounds`",
            parse_mode='Markdown'
        )
        return
    
    try:
        value = float(context.args[0])
        unit_from = context.args[1].lower()
        unit_to = context.args[3].lower()
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–ª–∏–Ω—ã
        length_units = {
            'km': 1000, 'm': 1, 'cm': 0.01, 'mm': 0.001,
            'miles': 1609.34, 'feet': 0.3048, 'inches': 0.0254
        }
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–µ—Å–∞
        weight_units = {
            'kg': 1, 'g': 0.001, 'pounds': 0.453592, 'ounces': 0.0283495
        }
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        if unit_from == 'celsius' and unit_to == 'fahrenheit':
            result = (value * 9/5) + 32
            await update.message.reply_text(f"üå°Ô∏è {value}¬∞C = {result:.2f}¬∞F")
            return
        elif unit_from == 'fahrenheit' and unit_to == 'celsius':
            result = (value - 32) * 5/9
            await update.message.reply_text(f"üå°Ô∏è {value}¬∞F = {result:.2f}¬∞C")
            return
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–ª–∏–Ω—ã
        if unit_from in length_units and unit_to in length_units:
            meters = value * length_units[unit_from]
            result = meters / length_units[unit_to]
            await update.message.reply_text(f"üìè {value} {unit_from} = {result:.4f} {unit_to}")
            return
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–µ—Å–∞
        if unit_from in weight_units and unit_to in weight_units:
            kg = value * weight_units[unit_from]
            result = kg / weight_units[unit_to]
            await update.message.reply_text(f"‚öñÔ∏è {value} {unit_from} = {result:.4f} {unit_to}")
            return
        
        await update.message.reply_text(
            "‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è.\n\n"
            "–î–ª–∏–Ω–∞: km, m, cm, mm, miles, feet, inches\n"
            "–í–µ—Å: kg, g, pounds, ounces\n"
            "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: celsius, fahrenheit"
        )
    except (ValueError, IndexError) as e:
        await update.message.reply_text("‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /convert <–∑–Ω–∞—á–µ–Ω–∏–µ> <–∏–∑> to <–≤>")

# –§—É–Ω–∫—Ü–∏—è 5: –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
async def random_number(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª"""
    if not context.args:
        number = random.randint(1, 100)
        await update.message.reply_text(f"üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ (1-100): **{number}**", parse_mode='Markdown')
        return
    
    try:
        if len(context.args) == 1:
            max_num = int(context.args[0])
            number = random.randint(1, max_num)
            await update.message.reply_text(f"üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ (1-{max_num}): **{number}**", parse_mode='Markdown')
        elif len(context.args) == 2:
            min_num = int(context.args[0])
            max_num = int(context.args[1])
            if min_num > max_num:
                min_num, max_num = max_num, min_num
            number = random.randint(min_num, max_num)
            await update.message.reply_text(f"üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ ({min_num}-{max_num}): **{number}**", parse_mode='Markdown')
        else:
            await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /random [–º–∏–Ω] [–º–∞–∫—Å]\n–ü—Ä–∏–º–µ—Ä: /random 1 100")
    except ValueError:
        await update.message.reply_text("‚ùå –û—à–∏–±–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞\n–ü—Ä–∏–º–µ—Ä: /random 1 100")

# –§—É–Ω–∫—Ü–∏—è 6: –í—Ä–µ–º—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö
async def timezone_info(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö"""
    timezones = {
        'moscow': ('Europe/Moscow', '–ú–æ—Å–∫–≤–∞'),
        'new york': ('America/New_York', '–ù—å—é-–ô–æ—Ä–∫'),
        'tokyo': ('Asia/Tokyo', '–¢–æ–∫–∏–æ'),
        'london': ('Europe/London', '–õ–æ–Ω–¥–æ–Ω'),
        'paris': ('Europe/Paris', '–ü–∞—Ä–∏–∂'),
        'beijing': ('Asia/Shanghai', '–ü–µ–∫–∏–Ω'),
        'sydney': ('Australia/Sydney', '–°–∏–¥–Ω–µ–π'),
        'dubai': ('Asia/Dubai', '–î—É–±–∞–π'),
    }
    
    if not context.args:
        now = datetime.now()
        text = "üïê **–í—Ä–µ–º—è –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö:**\n\n"
        
        for key, (tz_name, city_name) in timezones.items():
            try:
                import pytz
                tz = pytz.timezone(tz_name)
                local_time = datetime.now(tz)
                text += f"**{city_name}**: {local_time.strftime('%H:%M:%S %d.%m.%Y')}\n"
            except:
                text += f"**{city_name}**: (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)\n"
        
        await update.message.reply_text(text, parse_mode='Markdown')
        return
    
    city = ' '.join(context.args).lower()
    
    if city in timezones:
        try:
            import pytz
            tz_name, city_name = timezones[city]
            tz = pytz.timezone(tz_name)
            local_time = datetime.now(tz)
            await update.message.reply_text(
                f"üïê **{city_name}**\n\n"
                f"–í—Ä–µ–º—è: {local_time.strftime('%H:%M:%S')}\n"
                f"–î–∞—Ç–∞: {local_time.strftime('%d.%m.%Y')}\n"
                f"–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: {tz_name}",
                parse_mode='Markdown'
            )
        except ImportError:
            await update.message.reply_text(
                "‚ùå –î–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ pytz.\n"
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pip install pytz`",
                parse_mode='Markdown'
            )
        except Exception as e:
            await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
    else:
        available = ', '.join([name for _, (_, name) in timezones.items()])
        await update.message.reply_text(
            f"‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω.\n\n"
            f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞: {available}\n"
            f"–ü—Ä–∏–º–µ—Ä: /timezone Moscow"
        )

async def show_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    await update.message.reply_text(
        "üìã **–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é**\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é:",
        reply_markup=create_main_menu(),
        parse_mode='Markdown'
    )

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É"""
    help_text = (
        "üìã **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º**\n\n"
        "**–û—Å–Ω–æ–≤–Ω—ã–µ:**\n"
        "`/start` - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "`/menu` - –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é\n"
        "`/help` - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n"
        "**–§—É–Ω–∫—Ü–∏–∏:**\n"
        "üîî `/remind` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
        "üåê `/translate` - –ø–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞\n"
        "üîê `/password` - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π\n"
        "üßÆ `/calc` - –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä\n"
        "üòÑ `/joke` - —Å–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞\n"
        "üìè `/convert` - –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü\n"
        "üé≤ `/random` - —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ\n"
        "üïê `/timezone` - –≤—Ä–µ–º—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/menu` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é!"
    )
    await update.message.reply_text(help_text, parse_mode='Markdown')

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    application = Application.builder().token(BOT_TOKEN).build()
    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("menu", show_menu))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CommandHandler("remind", set_reminder))
    application.add_handler(CommandHandler("list", list_reminders))
    application.add_handler(CommandHandler("cancel", cancel_reminder))
    application.add_handler(CommandHandler("translate", translate_text))
    
    application.add_handler(CommandHandler("password", generate_password))
    application.add_handler(CommandHandler("calc", calculator))
    application.add_handler(CommandHandler("joke", random_joke))
    application.add_handler(CommandHandler("convert", unit_converter))
    application.add_handler(CommandHandler("random", random_number))
    application.add_handler(CommandHandler("timezone", timezone_info))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
    application.add_handler(CallbackQueryHandler(menu_handler))
    
    job_queue = application.job_queue
    if job_queue is not None:
        job_queue.run_repeating(reminder_job, interval=60, first=10)
        logger.info("JobQueue –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
    else:
        logger.warning("JobQueue –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install 'python-telegram-bot[job-queue]'")
    
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")
    
    try:
        application.run_polling(
            allowed_updates=Update.ALL_TYPES,
            drop_pending_updates=True,
            stop_signals=None
        )
    except RuntimeError as e:
        if "event loop is already running" in str(e):
            logger.error("–û—à–∏–±–∫–∞ event loop. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω nest-asyncio: pip install nest-asyncio")
            logger.error("–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –≤–Ω–µ Jupyter/Colab")
            raise
        else:
            raise

if __name__ == '__main__':
    main()
